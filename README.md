# Scroll Bible Infrastructure

All the infrastructure as code for Scroll Bible

## Developer Notes

### Deploy
- `npm run cdk deploy`
  - if you're running this for the first time, the certificate creation step
    will hang until you create the necessary DNS records. Through the AWS
    Console, navigate to Certificate Manager, find the newly requested
    certificate, find the CNAME record information, then through the domain DNS
    add the necessary CNAME record. The certificate will stay in "pending
    validation" state for some time, and the CDK deploy will likewise be
    pending. This is a one-time step (the first time you deploy in this
    environment).
      - if it's taking longer than a few minutes after you've created the
        records, then you probably created the records incorrectly. You can
        double check by copying the record name/value to the clipboard and
        searching for it on your DNS manager to make sure the strings match.
      - if you're doing a quick local development deploy and you don't need the
        share links to work, you can comment out the `SharingApi` line in
        `application-stack.ts` -- the rest of the app is independent of the
        sharing API.
- create the DNS records described below

### DNS records

```
CNAME scrollbible.app          <static hosting domain>
CNAME www.scrollbible.app      scrollbible.app
CNAME x1.share.scrollbible.app <certificate verification url to match x1>
CNAME share.scrollbible.app    <apigateway custom domain value provided by AWS>
```

### Notes auto-generated by the CDK initializer

The `cdk.json` file tells the CDK Toolkit how to execute your app.

#### Useful commands

* `npm run build`   compile typescript to js
* `npm run watch`   watch for changes and compile
* `npm run test`    perform the jest unit tests
* `cdk deploy`      deploy this stack to your default AWS account/region
* `cdk diff`        compare deployed stack with current state
* `cdk synth`       emits the synthesized CloudFormation template
